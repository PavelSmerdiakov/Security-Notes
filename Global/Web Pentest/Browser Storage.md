session fixation  
cookie poisoning  
insecure storage  
confusion de domaine  
Technology  
Description  
[Cookies](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies "https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies")

An HTTP cookie is a small piece of data that the web server and browser send each other to remember stateful information across page navigation.

[Web Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API "https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API")

The Web Storage API provides mechanisms for webpages to store string-only key/value pairs, including `localStorage` and `sessionStorage`.

[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API "https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API")

IndexedDB is a Web API for storing large data structures in the browser and indexing them for high-performance searching.

[Cache API](https://developer.mozilla.org/en-US/docs/Web/API/Cache "https://developer.mozilla.org/en-US/docs/Web/API/Cache")

The Cache API provides a persistent storage mechanism for HTTP request and response object pairs that's used to make webpages load faster.

[Origin Private File System (OPFS)](https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system "https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system")

OPFS provides a file system that's private to the origin of the page and can be used to read and write directories and files.

_**Cookie :**_  
[https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies "https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies")

C'est un token qui est envoyé par le serveur vers le navigateur de l'utilisateur. Il est stocké sous format texte puis sera à disposition du serveur quand il le demandera. Il sert principalement à savoir si l'utilisateur qui demande une ressource est bien celui qu'il prétend. Les cookies sont envoyés dans chaque requête HTTP.

**On l'utilise dans deux cas majoritaires :**

- _Gestion de sessions :_ Login, panier d'achat, score de jeu ou tout ce que le serveur doit retenir.
- _Tracking :_ Les infos pour les trackers tiers.

**Où les cookies sont envoyés :**

- _Domain_ : Si l'attribut domain n'est pas spécifié manuellement, le cookie prendra automatiquement le domaine ou sous-domaine actuel. Sinon, on le déclare comme ça : Domain=prout.com. L'attribut domaine sert à spécifier le domaine complet où le cookie est valide. Donc dans toutes les pages de ce domaine et tous les sous-domaines, le cookie sera valide.
- *Path* : C'est pareil sauf qu'on précise un chemin de l'url et pas un domaine. On peut l'attribuer comme ceci : Path=/groscaca donc dans tout ce qui est en dessous, le cookie sera valide.

**Samesite Attribut :**

Définit la manière dont les cookies sont envoyé dans les requêtes HTTP avec les autres sites ou non. Trois valeurs possibles :

***Samesite=None***: Le cookie est envoyé dans toutes les requêtes y compris celle en cross-site. Il faut quand même que la requête ait un lien avec le site d'origine hein. L'attribut Secure doit être sur True aussi parce que sinon c'est pas safe. Si tu vois en pentest un cookie samesite=none sans le secure activé, check ce qu'il fait parce que ca peut être cool à exploit.

**Exemple de requête où les cookie peuvent être transmis grâce (à cause aussi hein c'est assez inquiétant mdr) à leur attributs samesite sur none :**

1. *Lien hypertexte vers un site tiers* : Lorsque l'utilisateur clique sur un lien hypertexte qui redirige vers un site tiers à partir du site d'origine, les cookies SameSite=None peuvent être inclus dans la requête vers le site tiers.
    
2. _Inclusion de ressources tierces_ : Si le site d'origine inclut des ressources tierces, telles que des images, des scripts ou des vidéos, provenant d'un site tiers, les cookies peuvent également être envoyés avec ces requêtes.
    
3. _Widgets sociaux_ : Les widgets sociaux ou les boutons de partage social intégrés sur le site d'origine peuvent entraîner l'envoi de cookies vers les sites de médias sociaux lorsqu'un utilisateur interagit avec ces widgets.
    
4. _Publicités tierces_ : Les cookies de suivi publicitaire sont souvent utilisés pour suivre l'interaction de l'utilisateur avec des publicités tierces lorsqu'elles sont affichées sur le site d'origine.
    

_**Samesite=Lax**_ : C'est pareil que la valeur None sauf que les cookies ne peuvent être envoyé en cross-site qu'avec des requêtes GET donc quand on clique sur un lien vers un site tiers par exemple.

***Samesite=Strict*** : Cette fois-ci, les cookies avec cet attribut sont seulement dans les requêtes à l'intérieur du site.

||||
|---|---|---|
|**Request Type**|**Example Code**|**Cookies Sent When**|
|Link|[](#)|NotSet, Lax, None|
|Prerender||NotSet, Lax, None|
|Form GET||NotSet, Lax, None|
|Form POST||NotSet, None|
|iframe||NotSet, None|
|AJAX|$.get("...")|NotSet, None|
|Image|![](...)|NotSet, None|

**Cookie Prefixe :**

Un cookie prefixe c'est pour catégoriser les cookies. En gros on nomme les cookies avec des prefixe pour les désigner et pour catégoriser les cookies sécurisé, important ou autre. Les prefixes ont des conditions pour qu'ils se créer correctement. S'ils ne remplissent pas les conditions, les navigateur vont les rejeter. RAPPORT AVEC LES SESSIONS FIXATION JE CROIS.

Exemple de préfixes :

- `___host-_` : Pour qu'il soient accepté dans une requête set-cookie (pour que la création de cookie se passe bien), il doit avoir été créer via une source sécurisé (créé via un domaine https), avoir l'attribut secure activé, ne pas inclure d'attribut domain et avoir le chemin / dans le path. Il pourra donc être perçu comme un Domain-Locked.
- `___Secure_` : Plus faible que `__host-`, il est accepté dans une requête set-cookie seulement s'il a l'attribut secure activé et qu'il vient d'une source sécurisée.

**Cookie First party et Third party : **

- *First party* : C'est un cookie qui est créer par un site qui est utilisé uniquement pour ce site. Si l'attribut domain combiné avec le scheme (http ou https) sont identique à ceux dans l'url actuelle dans le navigateur de l'user, alors c'est un cookie First party.
- _Third party_ : C'est un cookie qui est créer par un site tiers qui est utilisé pour le site actuel mais aussi le site tiers. Si l'attribut domain combiné avec le scheme sont différent de l'url actuel de la page que visite l'user, alors c'est un cookie Third party. Par exemple, les pubs sur des sites utilisent des cookies third party car ils sont émis par un site tiers. Ca marche aussi avec des images ou tout autre éléments qui provient d'un site tiers. Ces cookie sont principalement utilisé pour les tracking, les profilages d'user ou autre merdier du genre. Ces cookies sont dans les requêtes qui vont vers le site tiers car en fait c'est notre navigateur qui demande ces éléments à un site tiers, donc il envoie les cookies en échange si tu préfère.

**Same-origin Policy :**

C'est des règles qui définissent la sécurité, la confidentialité et la porté des cookies. S'applique aux cookies, aux web storage et autres.

**Ordre d'envoi de deux cookie avec le même nom :**

Si deux cookies ont le mêmes nom, on envoie dans la requête celui qui a l'attribut path qui match le plus avec l'url actuel de l'user. Si les deux cookies ont le même path, on prend le plus jeune.

_**Web Storage API :**_  
[https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API "https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API")

C'est un peu la nouvelle version des cookies. C'est comme des cookies sauf que c'est plus rapide car ce n'est pas envoyé dans chaque requête HTTP, à l'inverse des cookies. C'est également un bon moyen de stockage de préférences puisqu'on peut stocker au max 5mb de données dans chacun des deux storage ce qui est beaucoup plus que les cookies (on va pas envoyer 5mb de cookie dans chaque requête). Ce qu'il y a dans le web storage API n'est jamais transmis au serveur directement. Cependant, les web storage API ne sont pas faites pour être sécurisées.

Le Web Storage API est divisé en deux catégories :

Le local storage : toutes les données qui sont faites pour rester dans le temps comme des préférences, des paramètres ou autre truc du genre.

Le session storage : Les données dans cette catégorie disparaîtront quand l'onglet sera fermé.

![comparaison_cookie_web_storage_api.png](file:///home/wpkaliuser/.config/joplin-desktop/resources/c7ed960920e8df16f41763ef72600a0a.png?t=1704547534182)  
_**IndexedDB :**_  
[https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API "https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API")

C'est une petite database dans le navigateur. A la différence d'une DB comme sql, indexedDB c'est JS-based orienté objet ca veut dire qu'on utilise les key-value. Comme en python si tu préfère. IndexedDB utilise une API Javascript donc on gère tous avec ça. Cet DB utilise fait des opérations asynchrones ca veut dire qu'il fait les actions en arrière-plan. C'est comme AJAX qui fait des requêtes en arrière-plan pour que l'user puisse utiliser les autres fonctionnalité en attendant une réponse.

C'est utilisé pour  stocker des éléments de tailles plus cconséquentes.